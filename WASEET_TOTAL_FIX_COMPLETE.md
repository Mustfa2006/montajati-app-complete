# ๐ฏ ุฅุตูุงุญ ุดุงูู ููุดููุฉ ุงููุจูุบ ุงููุฑุณู ูููุณูุท

## ๐ ุงูุชุญููู ุงูุดุงูู ูููุดููุฉ

### ุงููุดููุฉ ุงูุฃุณุงุณูุฉ:
- **ุงููุจูุบ ุงูุฅุฌูุงูู ูู ุงูุชุทุจูู**: 24,000 ุฏ.ุน
- **ุงููุจูุบ ุงููุฑุณู ูููุณูุท**: 21,000 ุฏ.ุน (ูุงูุต 3,000 ุฏ.ุน)

### ุงูุณุจุจ ุงูุฌุฐุฑู:
ูู `order_summary_page.dart`ุ ูุงู ุงูููุฏ ูุญุณุจ:
```dart
final finalTotal = subtotal + _deliveryFee; // ุงููุจูุบ ุงููุฎูุถ
```

ุญูุซ `_deliveryFee` ูู ุงููุจูุบ ุงููุฎูุถ ุจุนุฏ ุงูุณูุงูุฏุฑุ ูููุณ ุฑุณูู ุงูุชูุตูู ุงููุงููุฉ!

### ูุซุงู ุชูุถูุญู:
- **ูุฌููุน ุงูููุชุฌุงุช**: 21,000 ุฏ.ุน
- **ุฑุณูู ุงูุชูุตูู ุงูุฃุณุงุณูุฉ**: 5,000 ุฏ.ุน
- **ุฑุณูู ุงูุชูุตูู ุจุนุฏ ุงูุณูุงูุฏุฑ**: 2,000 ุฏ.ุน (ูุฎูุถุฉ)
- **ุงููุจูุบ ุงููุญููุธ ูู `total`**: 21,000 + 2,000 = 23,000 ุฏ.ุน โ
- **ุงููุจูุบ ุงูุตุญูุญ ูููุณูุท**: 21,000 + 5,000 = 26,000 ุฏ.ุน โ

## โ ุงูุญู ุงูููุทุจู

### 1. ุฅุถุงูุฉ ุญูู ุฌุฏูุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
```sql
ALTER TABLE orders 
ADD COLUMN IF NOT EXISTS waseet_total DECIMAL(12,2);
```

- **`total`**: ุงููุจูุบ ุงููุฏููุน ูู ุงูุนููู (ูุฎูุถ)
- **`waseet_total`**: ุงููุจูุบ ุงููุงูู ูููุณูุท (ุจุฏูู ุชุฎููุถ)

### 2. ุชุญุฏูุซ Frontend (order_summary_page.dart)

#### ุฃ. ุชุญุฏูุซ ุญุณุงุจ ุงููุจุงูุบ:
```dart
// ๐ฏ ุงููุจูุบ ุงูุฅุฌูุงูู ุงููุงูู (ูููุณูุท)
final fullTotal = subtotal + baseDeliveryFee;

// ๐ฐ ุงููุจูุบ ุงููุฏููุน ูู ุงูุนููู (ูุฎูุถ)
final customerTotal = subtotal + _deliveryFee;
```

#### ุจ. ุชุญุฏูุซ ุงูุจูุงูุงุช ุงูููุฑุณูุฉ:
```dart
'total': customerTotal,        // ๐ฐ ุงููุจูุบ ุงููุฏููุน ูู ุงูุนููู
'waseetTotal': fullTotal,      // ๐ฏ ุงููุจูุบ ุงููุงูู ูููุณูุท
```

### 3. ุชุญุฏูุซ Backend (order_sync_service.js)

#### ุฃ. ูู `createDefaultWaseetData`:
```javascript
// ๐ฏ ุงุณุชุฎุฏุงู ุงููุจูุบ ุงููุงูู ูููุณูุท
totalPrice = order.waseet_total || order.total || productsSubtotal;
```

#### ุจ. ูู `sendOrderToWaseet`:
```javascript
price: waseetData.totalPrice || order.waseet_total || order.total || 25000,
```

### 4. ุชุญุฏูุซ Frontend Service (order_sync_service.dart)
```dart
price: waseetData['totalPrice'] ?? orderResponse['waseetTotal'] ?? orderResponse['total'] ?? 25000,
```

## ๐ ุงููููุงุช ุงูููุนุฏูุฉ

### Frontend:
1. **`frontend/lib/pages/order_summary_page.dart`**
   - ุชุญุฏูุซ `_calculateFinalValues()`
   - ุฅุถุงูุฉ `fullTotal` ู `customerTotal`
   - ุชุญุฏูุซ ุงูุจูุงูุงุช ุงูููุฑุณูุฉ

2. **`frontend/lib/services/order_sync_service.dart`**
   - ุชุญุฏูุซ ุงุณุชุฎุฏุงู `waseetTotal`

### Backend:
1. **`backend/services/order_sync_service.js`**
   - ุชุญุฏูุซ `createDefaultWaseetData()`
   - ุชุญุฏูุซ `sendOrderToWaseet()`

### Database:
1. **`backend/database/add_waseet_total_field.sql`**
   - ุฅุถุงูุฉ ุญูู `waseet_total`
   - ุชุญุฏูุซ ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ

## ๐ ุฎุทูุงุช ุงูุชุทุจูู

### 1. ุชุทุจูู ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช
```bash
# ุชุดุบูู SQL script
psql -d your_database -f backend/database/add_waseet_total_field.sql

# ุฃู ุจุงุณุชุฎุฏุงู Supabase Dashboard
# ูุณุฎ ููุตู ูุญุชูู ุงูููู ูู SQL Editor
```

### 2. ุชุทุจูู ุงูุฅุตูุงุญ ุงูุชููุงุฆู
```bash
# ุชุญุฏูุซ ุจูุงูุงุช Supabase ูู ุงูููู ุฃููุงู
node apply_waseet_total_fix.js
```

### 3. ุฅุนุงุฏุฉ ุจูุงุก ุงูุชุทุจูู
```bash
cd frontend
flutter clean
flutter pub get
flutter build web --release
```

### 4. ุงุฎุชุจุงุฑ ุงูุฅุตูุงุญ
1. ุฅูุดุงุก ุทูุจ ุฌุฏูุฏ
2. ุชุทุจูู ุชุฎููุถ ุนูู ุฑุณูู ุงูุชูุตูู
3. ุฑูุน ุงูุทูุจ ูููุณูุท
4. ุงูุชุญูู ูู ุงููุจูุบ ุงููุฑุณู

## ๐งช ุงุฎุชุจุงุฑ ุงููุชุงุฆุฌ

### ูุจู ุงูุฅุตูุงุญ:
- ูุฌููุน ุงูููุชุฌุงุช: 21,000 ุฏ.ุน
- ุฑุณูู ุงูุชูุตูู (ูุฎูุถุฉ): 2,000 ุฏ.ุน
- **ุงููุจูุบ ุงููุฑุณู ูููุณูุท**: 23,000 ุฏ.ุน โ

### ุจุนุฏ ุงูุฅุตูุงุญ:
- ูุฌููุน ุงูููุชุฌุงุช: 21,000 ุฏ.ุน
- ุฑุณูู ุงูุชูุตูู (ูุงููุฉ): 5,000 ุฏ.ุน
- **ุงููุจูุบ ุงููุฑุณู ูููุณูุท**: 26,000 ุฏ.ุน โ

## ๐ ูุฑุงูุจุฉ ุงููุชุงุฆุฌ

### 1. ูุญุต ูุงุนุฏุฉ ุงูุจูุงูุงุช
```sql
SELECT 
    id,
    customer_name,
    total as customer_paid,
    waseet_total as waseet_amount,
    waseet_total - total as difference
FROM orders 
WHERE waseet_total IS NOT NULL
ORDER BY created_at DESC
LIMIT 10;
```

### 2. ูุญุต ุจูุงูุงุช ุงููุณูุท
```sql
SELECT 
    id,
    customer_name,
    (waseet_data::jsonb->>'totalPrice')::numeric as waseet_price,
    waseet_total,
    total
FROM orders 
WHERE waseet_data IS NOT NULL
ORDER BY created_at DESC
LIMIT 5;
```

## โ๏ธ ููุงุญุธุงุช ูููุฉ

### 1. ุงูุทูุจุงุช ุงูููุฌูุฏุฉ
- ุณูุชู ุญุฐู `waseet_data` ููุทูุจุงุช ุงูููุฌูุฏุฉ
- ุณูุชู ุฅุนุงุฏุฉ ุฅูุดุงุคูุง ุจุงููุจูุบ ุงูุตุญูุญ ุนูุฏ ุงูุญุงุฌุฉ

### 2. ูุงุฌูุฉ ุงููุณุชุฎุฏู
- ุณุชุนุฑุถ ุงููุจูุบ ุงููุฏููุน ูู ุงูุนููู (ูุฎูุถ)
- ููู ุณุชุญูุธ ุงููุจูุบ ุงููุงูู ูููุณูุท ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### 3. ุงูุชูุงูู ุงูุนูุณู
- ุงูููุฏ ูุฏุนู ุงูุทูุจุงุช ุงููุฏููุฉ ุงูุชู ููุณ ูุฏููุง `waseet_total`
- ุณูุณุชุฎุฏู `total` ูุจุฏูู

## ๐ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

ุจุนุฏ ุชุทุจูู ูุฐุง ุงูุฅุตูุงุญ:

โ **ุงููุจูุบ ุงููุฑุณู ูููุณูุท ุณูููู ุตุญูุญุงู** (26,000 ุฏ.ุน)
โ **ุงููุจูุบ ุงููุนุฑูุถ ููุนููู ุณูููู ูุฎูุถุงู** (23,000 ุฏ.ุน)
โ **ุงูุทูุจุงุช ุงูุฌุฏูุฏุฉ ุณุชุนูู ุจุดูู ุตุญูุญ**
โ **ุงูุทูุจุงุช ุงููุฏููุฉ ุณุชูุญุฏุซ ุชููุงุฆูุงู**

## ๐ง ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุฅุฐุง ูู ูุนูู ุงูุฅุตูุงุญ:
1. ุชุญูู ูู ุฅุถุงูุฉ ุญูู `waseet_total` ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
2. ุชุญูู ูู ุชุญุฏูุซ ุงูููุฏ ูู ุฌููุน ุงููููุงุช
3. ุชุญูู ูู ุฅุนุงุฏุฉ ุจูุงุก ุงูุชุทุจูู
4. ุฑุงุฌุน ุณุฌูุงุช ุงูุฃุฎุทุงุก ูู Console

### ููุชุญูู ูู ุตุญุฉ ุงูุฅุตูุงุญ:
```bash
# ูุญุต ุทูุจ ูุญุฏุฏ
node fix_existing_orders_price.js check ORDER_ID
```
