import 'package:firebase_core/firebase_core.dart';
import 'package:firebase_messaging/firebase_messaging.dart';
import 'package:flutter/foundation.dart';
import 'package:flutter_local_notifications/flutter_local_notifications.dart';
import 'package:supabase_flutter/supabase_flutter.dart';
import '../firebase_options.dart';

/// Ø®Ø¯Ù…Ø© Firebase Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
class FirebaseService {
  static final FirebaseMessaging _firebaseMessaging =
      FirebaseMessaging.instance;
  static final FlutterLocalNotificationsPlugin _localNotifications =
      FlutterLocalNotificationsPlugin();
  static final SupabaseClient _supabase = Supabase.instance.client;

  /// ØªÙ‡ÙŠØ¦Ø© Firebase
  static Future<void> initialize() async {
    try {
      debugPrint('ğŸ”¥ Ø¨Ø¯Ø¡ ØªÙ‡ÙŠØ¦Ø© Firebase...');

      // ØªÙ‡ÙŠØ¦Ø© Firebase Core
      await Firebase.initializeApp(
        options: DefaultFirebaseOptions.currentPlatform,
      );

      // Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
      await _requestPermission();

      // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
      await _initializeLocalNotifications();

      // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ FCM Token
      await _getFCMToken();

      // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
      _setupMessageHandlers();

      debugPrint('âœ… ØªÙ… ØªÙ‡ÙŠØ¦Ø© Firebase Ø¨Ù†Ø¬Ø§Ø­');
    } catch (e) {
      debugPrint('âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Firebase: $e');
    }
  }

  /// Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
  static Future<void> _requestPermission() async {
    try {
      debugPrint('ğŸ“± Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª...');

      NotificationSettings settings = await _firebaseMessaging
          .requestPermission(
            alert: true,
            announcement: false,
            badge: true,
            carPlay: false,
            criticalAlert: false,
            provisional: false,
            sound: true,
          );

      if (settings.authorizationStatus == AuthorizationStatus.authorized) {
        debugPrint('âœ… ØªÙ… Ù…Ù†Ø­ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª');
      } else if (settings.authorizationStatus ==
          AuthorizationStatus.provisional) {
        debugPrint('âš ï¸ ØªÙ… Ù…Ù†Ø­ Ø¥Ø°Ù† Ù…Ø¤Ù‚Øª Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª');
      } else {
        debugPrint('âŒ ØªÙ… Ø±ÙØ¶ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª');
      }
    } catch (e) {
      debugPrint('âŒ Ø®Ø·Ø£ ÙÙŠ Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª: $e');
    }
  }

  /// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
  static Future<void> _initializeLocalNotifications() async {
    try {
      debugPrint('ğŸ”” ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©...');

      const AndroidInitializationSettings initializationSettingsAndroid =
          AndroidInitializationSettings('@mipmap/ic_launcher');

      const DarwinInitializationSettings initializationSettingsIOS =
          DarwinInitializationSettings(
            requestAlertPermission: true,
            requestBadgePermission: true,
            requestSoundPermission: true,
          );

      const InitializationSettings initializationSettings =
          InitializationSettings(
            android: initializationSettingsAndroid,
            iOS: initializationSettingsIOS,
          );

      await _localNotifications.initialize(
        initializationSettings,
        onDidReceiveNotificationResponse: _onNotificationTapped,
      );

      debugPrint('âœ… ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©');
    } catch (e) {
      debugPrint('âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©: $e');
    }
  }

  /// Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ FCM Token
  static Future<String?> _getFCMToken() async {
    try {
      debugPrint('ğŸ”‘ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ FCM Token...');

      String? token = await _firebaseMessaging.getToken();

      if (token != null) {
        debugPrint('âœ… FCM Token: ${token.substring(0, 20)}...');

        // Ø­ÙØ¸ Token ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        await _saveFCMToken(token);

        return token;
      } else {
        debugPrint('âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ FCM Token');
        return null;
      }
    } catch (e) {
      debugPrint('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ FCM Token: $e');
      return null;
    }
  }

  /// Ø­ÙØ¸ FCM Token ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
  static Future<void> _saveFCMToken(String token) async {
    try {
      final user = _supabase.auth.currentUser;
      if (user != null) {
        await _supabase
            .from('users')
            .update({'fcm_token': token})
            .eq('id', user.id);

        debugPrint('âœ… ØªÙ… Ø­ÙØ¸ FCM Token ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
      }
    } catch (e) {
      debugPrint('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ FCM Token: $e');
    }
  }

  /// Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
  static void _setupMessageHandlers() {
    try {
      debugPrint('ğŸ“¨ Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ø±Ø³Ø§Ø¦Ù„...');

      // Ø¹Ù†Ø¯ ÙˆØµÙˆÙ„ Ø±Ø³Ø§Ù„Ø© ÙˆØ§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙÙŠ Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©
      FirebaseMessaging.onMessage.listen(_handleForegroundMessage);

      // Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø¥Ø´Ø¹Ø§Ø± ÙˆØ§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
      FirebaseMessaging.onMessageOpenedApp.listen(_handleBackgroundMessage);

      // Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ù† Ø¥Ø´Ø¹Ø§Ø±
      _handleInitialMessage();

      debugPrint('âœ… ØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ø±Ø³Ø§Ø¦Ù„');
    } catch (e) {
      debugPrint('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ø±Ø³Ø§Ø¦Ù„: $e');
    }
  }

  /// Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙÙŠ Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©
  static Future<void> _handleForegroundMessage(RemoteMessage message) async {
    try {
      debugPrint('ğŸ“± ÙˆØµÙ„ Ø¥Ø´Ø¹Ø§Ø± ÙÙŠ Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©: ${message.notification?.title}');

      // Ø¹Ø±Ø¶ Ø¥Ø´Ø¹Ø§Ø± Ù…Ø­Ù„ÙŠ
      await _showLocalNotification(message);
    } catch (e) {
      debugPrint('âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©: $e');
    }
  }

  /// Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
  static Future<void> _handleBackgroundMessage(RemoteMessage message) async {
    try {
      debugPrint('ğŸ“± ØªÙ… ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ù† Ø¥Ø´Ø¹Ø§Ø±: ${message.notification?.title}');

      // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø·Ù‚ Ø§Ù„ØªÙ†Ù‚Ù„ Ù‡Ù†Ø§
      if (message.data['type'] == 'withdrawal_status_change') {
        // Ø§Ù„ØªÙ†Ù‚Ù„ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨
        debugPrint('ğŸ”„ Ø§Ù„ØªÙ†Ù‚Ù„ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨...');
      }
    } catch (e) {
      debugPrint('âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ù„ÙÙŠØ©: $e');
    }
  }

  /// Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
  static Future<void> _handleInitialMessage() async {
    try {
      RemoteMessage? initialMessage = await _firebaseMessaging
          .getInitialMessage();

      if (initialMessage != null) {
        debugPrint(
          'ğŸ“± ØªÙ… ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ù† Ø¥Ø´Ø¹Ø§Ø± Ø£ÙˆÙ„ÙŠ: ${initialMessage.notification?.title}',
        );
        await _handleBackgroundMessage(initialMessage);
      }
    } catch (e) {
      debugPrint('âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø£ÙˆÙ„ÙŠØ©: $e');
    }
  }

  /// Ø¹Ø±Ø¶ Ø¥Ø´Ø¹Ø§Ø± Ù…Ø­Ù„ÙŠ
  static Future<void> _showLocalNotification(RemoteMessage message) async {
    try {
      const AndroidNotificationDetails androidPlatformChannelSpecifics =
          AndroidNotificationDetails(
            'withdrawal_notifications',
            'Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨',
            channelDescription: 'Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ØªØ­Ø¯ÙŠØ«Ø§Øª Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨',
            importance: Importance.high,
            priority: Priority.high,
            showWhen: true,
            enableVibration: true,
            playSound: true,
          );

      const DarwinNotificationDetails iOSPlatformChannelSpecifics =
          DarwinNotificationDetails(
            presentAlert: true,
            presentBadge: true,
            presentSound: true,
          );

      const NotificationDetails platformChannelSpecifics = NotificationDetails(
        android: androidPlatformChannelSpecifics,
        iOS: iOSPlatformChannelSpecifics,
      );

      await _localNotifications.show(
        message.hashCode,
        message.notification?.title ?? 'Ø¥Ø´Ø¹Ø§Ø± Ø¬Ø¯ÙŠØ¯',
        message.notification?.body ?? 'Ù„Ø¯ÙŠÙƒ ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙŠØ¯',
        platformChannelSpecifics,
        payload: message.data.toString(),
      );
    } catch (e) {
      debugPrint('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø­Ù„ÙŠ: $e');
    }
  }

  /// Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
  static void _onNotificationTapped(NotificationResponse response) {
    try {
      debugPrint('ğŸ‘† ØªÙ… Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø¥Ø´Ø¹Ø§Ø±: ${response.payload}');

      // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø·Ù‚ Ø§Ù„ØªÙ†Ù‚Ù„ Ù‡Ù†Ø§
    } catch (e) {
      debugPrint('âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±: $e');
    }
  }

  /// Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ FCM Token Ø§Ù„Ø­Ø§Ù„ÙŠ
  static Future<String?> getCurrentToken() async {
    try {
      return await _firebaseMessaging.getToken();
    } catch (e) {
      debugPrint('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Token Ø§Ù„Ø­Ø§Ù„ÙŠ: $e');
      return null;
    }
  }

  /// ØªØ­Ø¯ÙŠØ« FCM Token
  static Future<void> refreshToken() async {
    try {
      await _firebaseMessaging.deleteToken();
      await _getFCMToken();
    } catch (e) {
      debugPrint('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Token: $e');
    }
  }

  /// Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
  static Future<void> sendTestNotification({
    required String title,
    required String body,
  }) async {
    try {
      debugPrint('ğŸ§ª Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ...');

      // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ØªØµÙØ­ Ù…Ø¨Ø§Ø´Ø±Ø©
      await _showBrowserNotification(title, body);

      // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù…Ø­Ù„ÙŠ Ø£ÙŠØ¶Ø§Ù‹
      try {
        const AndroidNotificationDetails androidPlatformChannelSpecifics =
            AndroidNotificationDetails(
              'test_notifications',
              'Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©',
              channelDescription: 'Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±',
              importance: Importance.max,
              priority: Priority.high,
              showWhen: true,
              enableVibration: true,
              playSound: true,
              icon: 'ic_notification',
            );

        const DarwinNotificationDetails iOSPlatformChannelSpecifics =
            DarwinNotificationDetails(
              presentAlert: true,
              presentBadge: true,
              presentSound: true,
            );

        const NotificationDetails platformChannelSpecifics =
            NotificationDetails(
              android: androidPlatformChannelSpecifics,
              iOS: iOSPlatformChannelSpecifics,
            );

        await _localNotifications.show(
          DateTime.now().millisecondsSinceEpoch.remainder(100000),
          title,
          body,
          platformChannelSpecifics,
          payload: 'test_notification',
        );
      } catch (localError) {
        debugPrint('âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø­Ù„ÙŠ: $localError');
      }

      debugPrint('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ Ø¨Ù†Ø¬Ø§Ø­');
    } catch (e) {
      debugPrint('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ: $e');
    }
  }

  /// Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ØªØµÙØ­ Ù…Ø¨Ø§Ø´Ø±Ø©
  static Future<void> _showBrowserNotification(
    String title,
    String body,
  ) async {
    try {
      debugPrint('ğŸŒ Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ØªØµÙØ­...');

      // Ø§Ø³ØªØ®Ø¯Ø§Ù… JavaScript Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ØªØµÙØ­
      if (kIsWeb) {
        // Ø§Ø³ØªØ®Ø¯Ø§Ù… dart:html Ù„Ù„ÙˆÙŠØ¨
        await _showWebNotification(title, body);
      }
    } catch (e) {
      debugPrint('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ØªØµÙØ­: $e');
    }
  }

  /// Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„ÙˆÙŠØ¨
  static Future<void> _showWebNotification(String title, String body) async {
    try {
      debugPrint('ğŸ”” Ø¹Ø±Ø¶ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„ÙˆÙŠØ¨: $title - $body');

      if (kIsWeb) {
        // Ø§Ø³ØªØ®Ø¯Ø§Ù… JavaScript API Ù…Ø¨Ø§Ø´Ø±Ø©
        try {
          // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Notification API
          debugPrint('ğŸŒ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ØªØµÙØ­...');

          // Ø³ÙŠØªÙ… Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ù‡Ø°Ø§ Ø¹Ø¨Ø± JavaScript ÙÙŠ notifications.js
          debugPrint('ğŸ“¨ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¥Ù„Ù‰ JavaScript');
        } catch (jsError) {
          debugPrint('âš ï¸ Ø®Ø·Ø£ ÙÙŠ JavaScript: $jsError');
        }
      }

      debugPrint('âœ… ØªÙ… Ø¹Ø±Ø¶ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„ÙˆÙŠØ¨');
    } catch (e) {
      debugPrint('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„ÙˆÙŠØ¨: $e');
    }
  }

  /// Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù…Ø­Ù„ÙŠ Ù…Ø¨Ø§Ø´Ø±
  static Future<void> showDirectNotification({
    required String title,
    required String body,
    String? payload,
  }) async {
    try {
      debugPrint('ğŸ”” Ø¹Ø±Ø¶ Ø¥Ø´Ø¹Ø§Ø± Ù…Ø­Ù„ÙŠ Ù…Ø¨Ø§Ø´Ø±...');

      const AndroidNotificationDetails androidPlatformChannelSpecifics =
          AndroidNotificationDetails(
            'direct_notifications',
            'Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø©',
            channelDescription: 'Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…',
            importance: Importance.max,
            priority: Priority.high,
            showWhen: true,
            enableVibration: true,
            playSound: true,
            icon: 'ic_notification',
            ticker: 'Ø¥Ø´Ø¹Ø§Ø± Ø¬Ø¯ÙŠØ¯',
          );

      const DarwinNotificationDetails iOSPlatformChannelSpecifics =
          DarwinNotificationDetails(
            presentAlert: true,
            presentBadge: true,
            presentSound: true,
          );

      const NotificationDetails platformChannelSpecifics = NotificationDetails(
        android: androidPlatformChannelSpecifics,
        iOS: iOSPlatformChannelSpecifics,
      );

      await _localNotifications.show(
        DateTime.now().millisecondsSinceEpoch.remainder(100000),
        title,
        body,
        platformChannelSpecifics,
        payload: payload ?? 'direct_notification',
      );

      debugPrint('âœ… ØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø­Ù„ÙŠ Ø¨Ù†Ø¬Ø§Ø­');
    } catch (e) {
      debugPrint('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø­Ù„ÙŠ: $e');
    }
  }

  /// Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø±Ø³Ù…ÙŠ Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨
  static Future<void> sendWithdrawalNotification({
    required String status,
    required String amount,
    String? requestId,
  }) async {
    try {
      debugPrint('ğŸ“¢ Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø±Ø³Ù…ÙŠ Ù„Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨: $status - $amount Ø¯.Ø¹');

      String title, body;

      // ØªØ­Ø¯ÙŠØ¯ Ù†Øµ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©
      switch (status.toLowerCase()) {
        case 'completed':
        case 'transferred':
          title = 'ØªÙ… ØªØ­ÙˆÙŠÙ„ Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨';
          body = 'ØªÙ… ØªØ­ÙˆÙŠÙ„ Ù…Ø¨Ù„Øº $amount Ø¯.Ø¹ Ø¥Ù„Ù‰ Ù…Ø­ÙØ¸ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­';
          break;
        case 'rejected':
        case 'cancelled':
          title = 'ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨';
          body = 'ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø·Ù„Ø¨ Ø³Ø­Ø¨ Ø¨Ù…Ø¨Ù„Øº $amount Ø¯.Ø¹';
          break;
        case 'pending':
          title = 'Ø·Ù„Ø¨ Ø³Ø­Ø¨ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©';
          body = 'Ø·Ù„Ø¨ Ø³Ø­Ø¨ Ø¨Ù…Ø¨Ù„Øº $amount Ø¯.Ø¹ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©';
          break;
        default:
          title = 'ØªØ­Ø¯ÙŠØ« Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨';
          body = 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨ Ø¥Ù„Ù‰ $status';
      }

      // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø±Ø³Ù…ÙŠ
      await sendOfficialNotification(
        title: title,
        body: body,
        payload: 'withdrawal_$status',
        data: {
          'type': 'withdrawal_notification',
          'status': status,
          'amount': amount,
          'request_id': requestId,
          'timestamp': DateTime.now().toIso8601String(),
        },
      );

      debugPrint('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ø±Ø³Ù…ÙŠ Ø¨Ù†Ø¬Ø§Ø­');
    } catch (e) {
      debugPrint('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø³Ø­Ø¨: $e');
    }
  }

  /// Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø±Ø³Ù…ÙŠ Ù„Ù„Ù†Ø¸Ø§Ù…
  static Future<void> sendOfficialNotification({
    required String title,
    required String body,
    String? payload,
    Map<String, dynamic>? data,
  }) async {
    try {
      debugPrint('ğŸ“¢ Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø±Ø³Ù…ÙŠ: $title');

      // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…ØªØµÙØ­ (Web)
      if (kIsWeb) {
        await _showWebNotification(title, body);
      }

      // Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù…Ø­Ù„ÙŠ (Mobile & Desktop)
      await _showOfficialLocalNotification(
        title,
        body,
        payload ?? 'official_notification',
      );

      debugPrint('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø±Ø³Ù…ÙŠ Ø¨Ù†Ø¬Ø§Ø­');
    } catch (e) {
      debugPrint('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø±Ø³Ù…ÙŠ: $e');
    }
  }

  /// Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù…Ø­Ù„ÙŠ Ø±Ø³Ù…ÙŠ Ù…ÙˆØ­Ø¯
  static Future<void> _showOfficialLocalNotification(
    String title,
    String body,
    String payload,
  ) async {
    try {
      const AndroidNotificationDetails androidDetails =
          AndroidNotificationDetails(
            'withdrawal_notifications',
            'Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨',
            channelDescription: 'Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ØªØ­Ø¯ÙŠØ«Ø§Øª Ø­Ø§Ù„Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨',
            importance: Importance.max,
            priority: Priority.high,
            showWhen: true,
            enableVibration: true,
            playSound: true,
            icon: 'ic_notification',
            ticker: 'Ø¥Ø´Ø¹Ø§Ø± Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ù…Ù†ØªØ¬Ø§ØªÙŠ',
            autoCancel: true,
            ongoing: false,
          );

      const DarwinNotificationDetails iosDetails = DarwinNotificationDetails(
        presentAlert: true,
        presentBadge: true,
        presentSound: true,
        interruptionLevel: InterruptionLevel.active,
      );

      const NotificationDetails platformDetails = NotificationDetails(
        android: androidDetails,
        iOS: iosDetails,
      );

      await _localNotifications.show(
        DateTime.now().millisecondsSinceEpoch.remainder(100000),
        title,
        body,
        platformDetails,
        payload: payload,
      );

      debugPrint('ğŸ“± ØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø­Ù„ÙŠ');
    } catch (e) {
      debugPrint('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø­Ù„ÙŠ: $e');
    }
  }
}
