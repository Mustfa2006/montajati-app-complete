# ๐ ูุธุงู ุงูุฅุดุนุงุฑุงุช ุงูุฐูู ุงููุชูุงูู

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูุธุงู ุฅุดุนุงุฑุงุช ุฐูู ููุชูุงูู ุจุงููุงูู ูุฑุงูุจ ุชุบููุฑุงุช ุนููุฏ `status` ูู ุฌุฏูู `orders` ููุฑุณู ุฅุดุนุงุฑุงุช ูุณุชูุฏูุฉ ููู ูุณุชุฎุฏู ุญุณุจ ุทูุจุงุชู ููุท.

## โจ ุงููููุฒุงุช ุงูุฑุฆูุณูุฉ

- **๐ฏ ุฅุดุนุงุฑุงุช ูุณุชูุฏูุฉ**: ูู ูุณุชุฎุฏู ูุญุตู ุนูู ุฅุดุนุงุฑุงุช ุทูุจุงุชู ููุท
- **๐ซ ููุน ุงูุชูุฑุงุฑ**: ูุง ุชูุฌุฏ ุฅุดุนุงุฑุงุช ููุฑุฑุฉ ููุญุงูุฉ ููุณูุง
- **๐ ุฅุนุงุฏุฉ ุงููุญุงููุฉ**: ูุธุงู ุฐูู ูุฅุนุงุฏุฉ ุงููุญุงููุฉ ุนูุฏ ุงููุดู
- **๐ ูุฑุงูุจุฉ ุดุงููุฉ**: ุฅุญุตุงุฆูุงุช ููุตูุฉ ููุฑุงูุจุฉ ุงูุฃุฏุงุก
- **โก ูุนุงูุฌุฉ ููุฑูุฉ**: ุงุณุชุฌุงุจุฉ ููุฑูุฉ ูุชุบููุฑุงุช ุงูุญุงูุฉ
- **๐ก๏ธ ููุซูููุฉ ุนุงููุฉ**: ูุธุงู ููู ูููุงูู ููุฃุฎุทุงุก

## ๐จ ุฃููุงุน ุงูุฅุดุนุงุฑุงุช

### 1. ููุฏ ุงูุชูุตูู ๐
```
ุงูุนููู - ููุฏ ุงูุชูุตูู ๐
```

### 2. ุชู ุงูุชูุตูู ๐
```
ุงูุนููู - ุชู ุงูุชูุตูู ๐
```

### 3. ููุบู ๐ข
```
ุงูุนููู - ููุบู ๐ข
```

## ๐๏ธ ุจููุฉ ุงููุธุงู

### ๐ ูุงุนุฏุฉ ุงูุจูุงูุงุช

#### ุฌุฏูู `notification_queue`
- ูุงุฆูุฉ ุงูุชุธุงุฑ ุงูุฅุดุนุงุฑุงุช ุงููุฑุงุฏ ุฅุฑุณุงููุง
- ูุฏุนู ุงูุฃููููุงุช ูุฅุนุงุฏุฉ ุงููุญุงููุฉ

#### ุฌุฏูู `notification_logs`
- ุณุฌู ุฌููุน ุงูุฅุดุนุงุฑุงุช ุงููุฑุณูุฉ
- ูููุน ุงูุชูุฑุงุฑ ููููุฑ ุฅุญุตุงุฆูุงุช

#### ุฌุฏูู `user_fcm_tokens`
- ุชุฎุฒูู FCM tokens ูููุณุชุฎุฏููู
- ุฑุจุท ุงููุณุชุฎุฏููู ุจุฃุฑูุงู ููุงุชููู

### ๐ง ุงูููููุงุช ุงูุจุฑูุฌูุฉ

#### Database Trigger
- ูุฑุงูุจ ุชุบููุฑุงุช ุนููุฏ `status`
- ููุดุฆ ุฅุดุนุงุฑุงุช ุฐููุฉ ุชููุงุฆูุงู

#### ูุนุงูุฌ ูุงุฆูุฉ ุงูุงูุชุธุงุฑ
- ูุนุงูุฌ ุงูุฅุดุนุงุฑุงุช ุงููุนููุฉ
- ูุฏูุฑ ุฅุนุงุฏุฉ ุงููุญุงููุฉ ูุงูุฃุฎุทุงุก

#### ุฎุฏูุฉ Firebase
- ุฅุฑุณุงู ุงูุฅุดุนุงุฑุงุช ุนุจุฑ FCM
- ุฏุนู Android ู iOS

## ๐ ุงูุชุซุจูุช ูุงูุฅุนุฏุงุฏ

### 1. ูุชุบูุฑุงุช ุงูุจูุฆุฉ ุงููุทููุจุฉ

```bash
SUPABASE_URL=your_supabase_url
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key
FIREBASE_SERVICE_ACCOUNT={"type":"service_account",...}
```

### 2. ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช

```bash
# ุฅุนุฏุงุฏ ุงููุธุงู ุงููุงูู
npm run notification:setup

# ุฃู ุฅุนุฏุงุฏ ูุฏูู
node setup_smart_notifications.js setup
```

### 3. ุชุดุบูู ุงููุธุงู

```bash
# ุชุดุบูู ุงููุธุงู ุงููุงูู
npm run notification:system

# ุฃู ุชุดุบูู ุงููุนุงูุฌ ููุท
npm run notification:start
```

## ๐ ุงููุฑุงูุจุฉ ูุงูุฅุญุตุงุฆูุงุช

### ุนุฑุถ ุงูุฅุญุตุงุฆูุงุช
```bash
npm run notification:stats
```

### ูุฑุงูุจุฉ ุงูุฃุฏุงุก
```bash
# ุฅุญุตุงุฆูุงุช ููุตูุฉ
node start_smart_notification_system.js stats

# ุฅุญุตุงุฆูุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช
node setup_smart_notifications.js stats
```

## ๐งช ุงูุงุฎุชุจุงุฑ

### ุงุฎุชุจุงุฑ ุฅุดุนุงุฑ ูุจุงุดุฑ
```bash
npm run notification:test 07503597589
```

### ุงุฎุชุจุงุฑ ุงููุธุงู ุงููุงูู
```bash
npm run notification:system-test 07503597589
```

### ุงุฎุชุจุงุฑ Database Trigger
```bash
node start_smart_notification_system.js test 07503597589
```

## ๐ ููููุฉ ุนูู ุงููุธุงู

### 1. ูุฑุงูุจุฉ ุงูุชุบููุฑุงุช
```sql
-- ุนูุฏ ุชุญุฏูุซ ุญุงูุฉ ุงูุทูุจ
UPDATE orders SET status = 'in_delivery' WHERE id = 'ORDER123';

-- ูุชู ุชูุนูู Trigger ุชููุงุฆูุงู
-- ููุดุฆ ุฅุดุนุงุฑ ูู notification_queue
```

### 2. ูุนุงูุฌุฉ ุงูุฅุดุนุงุฑุงุช
```javascript
// ูุนุงูุฌ ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ูุนูู ูู 5 ุซูุงูู
// ูุฌูุจ ุงูุฅุดุนุงุฑุงุช ุงููุนููุฉ
// ูุฑุณููุง ุนุจุฑ Firebase
// ูุณุฌู ุงููุชุงุฆุฌ
```

### 3. ููุน ุงูุชูุฑุงุฑ
```javascript
// ุงูุชุญูู ูู ุนุฏู ุฅุฑุณุงู ุฅุดุนุงุฑ ููุงุซู ุฎูุงู ุขุฎุฑ 5 ุฏูุงุฆู
// ูููุณ ุงูุทูุจ ูููุณ ุงููุณุชุฎุฏู ูููุณ ุชุบููุฑ ุงูุญุงูุฉ
```

## ๐ฑ ุฅุนุฏุงุฏ ุงูุชุทุจูู (Frontend)

### ุชุณุฌูู FCM Token
```dart
// ูู ุงูุชุทุจููุ ุงุญูุธ FCM Token ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู
await NotificationService.saveUserFCMToken(userPhone);
```

### ุงุณุชูุจุงู ุงูุฅุดุนุงุฑุงุช
```dart
// ุฅุนุฏุงุฏ ูุนุงูุฌ ุงูุฅุดุนุงุฑุงุช
FirebaseMessaging.onMessage.listen((RemoteMessage message) {
  // ุนุฑุถ ุงูุฅุดุนุงุฑ ูููุณุชุฎุฏู
});
```

## ๐๏ธ ุงูุตูุงูุฉ ูุงูุชุญุณูู

### ุชูุธูู ุงูุจูุงูุงุช ุงููุฏููุฉ
```sql
-- ุชุดุบูู ุฏูุฑู ูุญุฐู ุงูุณุฌูุงุช ุงููุฏููุฉ
SELECT cleanup_old_notification_data();
```

### ูุฑุงูุจุฉ ุงูุฃุฏุงุก
- ูุนุฏู ูุฌุงุญ ุงูุฅุฑุณุงู
- ุฒูู ุงูุงุณุชุฌุงุจุฉ
- ุนุฏุฏ ุงูุฅุดุนุงุฑุงุช ุงููุนููุฉ

### ุชุญุณูู ุงูุฃุฏุงุก
- ููุฑุณุฉ ุงูุฌุฏุงูู
- ุชุญุณูู ุงุณุชุนูุงูุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุถุจุท ูุชุฑุงุช ุงููุนุงูุฌุฉ

## ๐จ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ูุดุงูู ุดุงุฆุนุฉ

#### ูุง ุชุตู ุงูุฅุดุนุงุฑุงุช
```bash
# ุชุญูู ูู FCM Token
npm run notification:test <phone_number>

# ุชุญูู ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ
npm run notification:stats
```

#### ุฅุดุนุงุฑุงุช ููุฑุฑุฉ
```bash
# ุชุญูู ูู ุณุฌู ุงูุฅุดุนุงุฑุงุช
node setup_smart_notifications.js stats
```

#### ุฃุฎุทุงุก Firebase
```bash
# ุชุญูู ูู ูุชุบูุฑุงุช ุงูุจูุฆุฉ
node test-firebase-vars.js
```

### ุณุฌูุงุช ุงููุธุงู
```bash
# ูุฑุงูุจุฉ ุงูุณุฌูุงุช ุงููุจุงุดุฑุฉ
npm run notification:start

# ุนุฑุถ ุฅุญุตุงุฆูุงุช ููุตูุฉ
npm run notification:stats
```

## ๐ ุงูุฏุนู ุงูููู

ููุญุตูู ุนูู ุงููุณุงุนุฏุฉ:
1. ุชุญูู ูู ุงูุณุฌูุงุช ูุงูุฅุญุตุงุฆูุงุช
2. ุงุฎุชุจุฑ ุงููุธุงู ุฎุทูุฉ ุจุฎุทูุฉ
3. ุชุฃูุฏ ูู ุตุญุฉ ูุชุบูุฑุงุช ุงูุจูุฆุฉ
4. ุฑุงุฌุน ุฏููู ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

## ๐ ุงูุชุญุฏูุซุงุช ุงููุณุชูุจููุฉ

- ุฏุนู ุฅุดุนุงุฑุงุช ุฅุถุงููุฉ (ุฑุณุงุฆู ุชุฑููุฌูุฉุ ุชุฐููุฑุงุช)
- ูุงุฌูุฉ ุฅุฏุงุฑุฉ ุงูุฅุดุนุงุฑุงุช
- ุชุญูููุงุช ูุชูุฏูุฉ ููุฃุฏุงุก
- ุฏุนู ูููุงุช ุฅุดุนุงุฑุงุช ูุชุนุฏุฏุฉ

---

**โ ุงููุธุงู ุฌุงูุฒ ููุนูู ุจุงููุงูู!**

ุงุณุชุฎุฏู `npm run notification:system` ูุจุฏุก ุงููุธุงู ุงููุงูู.
